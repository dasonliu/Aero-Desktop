# Aero Desktop - 智能沉浸式 Web 桌面系统

Aero Desktop 是一个基于 React 和 Google Gemini AI 驱动的现代化模拟桌面环境。它提供沉浸式的入场动画、高度可定制的快捷方式管理系统，以及深度集成的 AI 视觉资产生成能力。

## 1. 技术框架 (Technical Framework)

项目采用业界前沿的响应式、声明式前端技术栈：

*   **核心引擎**: [React 19](https://react.dev/) (使用并发渲染模式)
*   **交互动画**: [Framer Motion 12](https://www.framer.com/motion/) (负责图标飞行入场、模态框过度及拖拽交互)
*   **样式方案**: [Tailwind CSS](https://tailwindcss.com/) (实用优先的 CSS 框架，支持毛玻璃/背板模糊效果)
*   **图标库**: [Lucide React](https://lucide.dev/) (提供统一、轻量化的矢量图标)
*   **人工智能**: [Google Gemini API (@google/genai)](https://ai.google.dev/)
    *   `gemini-3-flash-preview`: 用于品牌名提取、文案建议及视觉提示词生成。
    *   `gemini-2.5-flash-image`: 用于生成 Icon (1:1)、Card (3:4) 及 Gallery (9:16) 三种比例的视觉资产。
*   **模块管理**: ESM 导入映射 (Import Maps)，无需构建工具即可在浏览器运行。

## 2. 项目目录结构 (Project Structure)

```text
.
├── index.html              # 应用入口，包含 Import Maps 和基础样式定义
├── index.tsx               # React 挂载点
├── App.tsx                 # 主容器，管理登录状态与全局布局
├── metadata.json           # 项目元数据与权限申请
├── types.ts                # TypeScript 全局类型定义（FileNode, LayoutMode 等）
├── constants.tsx           # 全局静态常量（如壁纸 URL）
├── config/
│   └── appRegistry.tsx     # 预设应用注册表（内置图标、颜色与 ID 映射）
├── context/
│   └── OSContext.tsx       # 核心状态机：管理文件系统、存储配额、网关布局逻辑
└── components/
    ├── LoginScreen.tsx     # 动态模糊登录界面
    ├── Desktop.tsx         # 桌面主容器：处理右键菜单、拖拽容器与入场动画触发
    ├── DesktopIcon.tsx     # 图标渲染组件：支持三种显示模式（图标/卡片/画廊）
    ├── Taskbar.tsx         # 系统任务栏：包含时钟、搜索栏与系统状态
    └── AddShortcutModal.tsx# 快捷方式工作室：集成 AI 生成、图片优化、手动上传功能
```

## 3. 核心功能与接口信息 (Features & Interfaces)

### 3.1 核心功能
*   **沉浸式飞入动画**: 进入桌面时，图标根据索引从屏幕四周飞向预设坐标。
*   **多维显示模式**: 支持 `Icon (1:1)`, `Card (3:4)`, `Gallery (9:16)` 三种展示布局。
*   **快捷方式工作室 (Shortcut Studio)**:
    *   **AI 风格化生成**: 可选择“看板娘”、“赛博汽车”、“萌猫”等预设风格。
    *   **自动提取**: 输入 URL 自动利用 Gemini 提取网站品牌名称。
    *   **三维资产同步**: 一次生成满足三种显示模式的差异化比例图片。
    *   **本地替换**: 支持用户手动上传图片并自动进行 WebP 压缩优化。
*   **智能存储管理**: 自动监测 LocalStorage 配额，容量不足时优先保留 Icon 缩略图并剔除重型资源，防止黑屏崩溃。
*   **动态布局引擎**: 右键“自动排列”可根据当前窗口宽度自动计算网格坐标。

### 3.2 主要数据接口 (`FileNode`)
```typescript
interface FileNode {
  id: string;        
  appId: AppID;      // 关联 appRegistry.tsx 中的预设配置
  label: string;     // 显示名称
  type: 'shortcut' | 'file' | 'folder';
  x: number;         // 桌面绝对坐标 X
  y: number;         // 桌面绝对坐标 Y
  url?: string;      // 外部链接
  thumbnails?: {     // 多分辨缩略图对象
    icon?: string;    // Base64 WebP (1:1)
    card?: string;    // Base64 WebP (3:4)
    gallery?: string; // Base64 WebP (9:16)
  };
}
```

## 4. 代码规范 (Coding Guidelines)

*   **单向数据流**: 所有文件系统操作必须通过 `useOS()` Hook 调用 `OSContext` 的方法。
*   **性能优化**: 
    *   图片上传或生成后，必须使用 `canvas` 转换为 WebP 格式并进行 0.6 质量压缩。
    *   频繁位置更新（如拖拽）需保证在 `framer-motion` 的变换层内，不触发父容器重绘。
*   **防御式渲染**: `DesktopIcon` 必须处理缩略图丢失的 Fallback 情况，默认回退到 `appRegistry` 中定义的 Lucide 图标。
*   **存储安全**: 禁止直接操作 `localStorage`，必须通过 `OSContext` 中的带 `try-catch` 包装的存取器，以处理存储空间溢出的极端情况。
*   **交互逻辑**: 
    *   必须使用右键菜单 (`onContextMenu`) 作为添加/编辑入口。
    *   模态框交互按钮需明确设置 `type="button"` 以防非预期的表单提交行为。

---
*Generated by Aero Engineering Standard v5.0*